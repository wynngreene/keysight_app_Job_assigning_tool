<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Operations — Scan + Training Lookup</title>

  <!-- Bootstrap 5 CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="app.css">
</head>

<body class="bg-light">

  <div class="container py-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2 class="mb-0">Daily Operations</h2>
    </div>

    <!-- TABS -->
    <ul class="nav nav-tabs mb-3" id="mainTabs">
      <li class="nav-item">
        <button
          class="nav-link active"
          id="tickTab"
          type="button"
          onclick="showPage('tick')">
          Tick
        </button>
      </li>
      <li class="nav-item">
        <button
          class="nav-link"
          id="operatorsTab"
          type="button"
          onclick="showPage('operators')">
          Operators
        </button>
      </li>
    </ul>

    <!-- ========== PAGE 1: TICK (Upload + Cards + Job Lists) ========== -->
    <div id="tickPage">
      <!-- TRAINING CSV UPLOAD -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title mb-2">Upload Training Sheet</h5>
          <p class="card-text mb-2">
            Upload the training CSV so the app knows which operators are trained on each part.
          </p>

          <div class="row g-3 align-items-center">
            <div class="col-sm-6 col-md-5 col-lg-4">
              <input
                type="file"
                id="csvInput"
                accept=".csv"
                class="form-control form-control-sm">
            </div>
            <div class="col-sm-6">
              <small class="text-muted">
                Uses your existing layout:<br>
                Header row for operators, "Trained / Trainer 1 / Trainer 2" = can build.
              </small>
            </div>
          </div>

          <div id="loadStatus" class="mt-2 small text-muted"></div>
        </div>
      </div>

      <!-- MAIN 3 CARDS -->
      <div class="row g-4">

        <!-- CARD 1: Scan Part -->
        <div class="col-12 col-md-4">
          <div class="card shadow-sm h-100">
            <div class="card-body">
              <h5 class="card-title">1. Scan Part</h5>
              <p class="card-text">
                Enter or scan a <strong>Part Number</strong>. We'll look up who can build it.
              </p>

              <!-- Input field -->
              <div class="mb-3">
                <label class="form-label" for="scanInput">Scan Input</label>
                <input
                  type="text"
                  class="form-control"
                  id="scanInput"
                  placeholder="Scan or type part number">
              </div>

              <!-- Button -->
              <button class="btn btn-primary w-100 mb-3" onclick="processScan()">
                Submit Scan
              </button>

              <!-- Result display -->
              <div id="scanResult" class="alert alert-secondary d-none"></div>
            </div>
          </div>
        </div>

        <!-- CARD 2: Trained Operators for Part + Assign Job -->
        <div class="col-12 col-md-4">
          <div class="card shadow-sm h-100">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">2. Pick Operator & Assign Job</h5>
              <p class="card-text">
                After scanning, this dropdown shows <strong>who is trained</strong> on that part.
                Then assign a job number to that operator.
              </p>

              <!-- Operator dropdown -->
              <div class="mb-2">
                <label class="form-label" for="operatorSelect">Trained Operators</label>
                <select class="form-select" id="operatorSelect" disabled>
                  <option value="">Upload training + scan a part</option>
                </select>
              </div>

              <!-- Job number input -->
              <div class="mb-2">
                <label class="form-label" for="jobNumberInput">Job Number</label>
                <input
                  type="text"
                  class="form-control"
                  id="jobNumberInput"
                  placeholder="Enter job number">
              </div>

              <!-- Assign button -->
              <button
                class="btn btn-success w-100 mb-2"
                id="assignJobBtn"
                onclick="assignJob()"
                disabled>
                Assign Job
              </button>

              <small id="operatorInfo" class="text-muted d-block mt-auto"></small>
            </div>
          </div>
        </div>

        <!-- CARD 3: Daily Log -->
        <div class="col-12 col-md-4">
          <div class="card shadow-sm h-100">
            <div class="card-body d-flex flex-column">

              <!-- Header + Date -->
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="card-title mb-0">3. Daily Log</h5>
                <small id="dailyLogDate" class="text-muted"></small>
              </div>

              <p class="card-text">
                View log entries for a specific day. Assignments and edits will show up here.
              </p>

              <!-- Day pagination -->
              <div class="d-flex justify-content-between mb-3">
                <button
                  class="btn btn-outline-secondary btn-sm"
                  onclick="changeLogDay(-1)">
                  ◀ Prev
                </button>
                <button
                  class="btn btn-outline-secondary btn-sm"
                  onclick="changeLogDay(1)">
                  Next ▶
                </button>
              </div>

              <!-- Search within the day's log -->
              <div class="input-group mb-3">
                <input
                  type="text"
                  id="logSearchInput"
                  class="form-control"
                  placeholder="Search today's log…">
                <button
                  class="btn btn-outline-primary"
                  type="button"
                  onclick="renderDailyLog()">
                  Search
                </button>
              </div>

              <!-- Log list -->
              <ul
                id="dailyLogList"
                class="list-group flex-grow-1 mb-0 log-list">
              </ul>

            </div>
          </div>
        </div>

      </div>

      <!-- JOB ASSIGNMENTS LIST (SEPARATED) -->
      <div class="mt-4">

        <!-- ACTIVE JOBS: Assigned + In Progress -->
        <div class="card mb-4">
          <div class="card-body">
            <h5 class="card-title mb-2">Active Jobs</h5>
            <small class="text-muted">Assigned & In Progress</small>

            <div class="table-responsive mt-2">
              <table class="table table-sm table-striped">
                <thead class="table-light">
                  <tr>
                    <th>Job #</th>
                    <th>Part #</th>
                    <th>Operator</th>
                    <th>Status</th>
                    <th>Time Assigned</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="activeJobsBody"></tbody>
              </table>
            </div>

            <div id="activeJobsPagination" class="mt-2"></div>
          </div>
        </div>

        <!-- COMPLETED JOBS -->
        <div class="card">
          <div class="card-body">
            <h5 class="card-title mb-2">Completed Jobs</h5>
            <small class="text-muted">Completed / Cancelled</small>

            <div class="table-responsive mt-2">
              <table class="table table-sm table-striped">
                <thead class="table-light">
                  <tr>
                    <th>Job #</th>
                    <th>Part #</th>
                    <th>Operator</th>
                    <th>Status</th>
                    <th>Time Assigned</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="completedJobsBody"></tbody>
              </table>
            </div>

            <div id="completedJobsPagination" class="mt-2"></div>
          </div>
        </div>

      </div>
    </div>

    <!-- ========== PAGE 2: OPERATORS SUMMARY ========== -->
    <div id="operatorsPage" class="d-none">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title mb-2">Operators Overview</h5>
          <p class="card-text">
            Shows each operator from the training sheet and how many jobs they have by status.
          </p>

          <div class="table-responsive mt-2">
            <table class="table table-sm table-striped">
              <thead class="table-light">
                <tr>
                  <th>Operator</th>
                  <th>Assigned</th>
                  <th>In Progress</th>
                  <th>Completed</th>
                  <th>Cancelled</th>
                  <th>Total Jobs</th>
                </tr>
              </thead>
              <tbody id="operatorsSummaryBody">
                <!-- Filled by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- EDIT ASSIGNMENT MODAL -->
  <div
    class="modal fade"
    id="editAssignmentModal"
    tabindex="-1"
    aria-labelledby="editAssignmentModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editAssignmentModalLabel">Edit Job Assignment</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="editAssignmentIndex">

          <div class="mb-2">
            <label class="form-label">Job Number</label>
            <input type="text" class="form-control" id="editJobNumber" disabled>
          </div>

          <div class="mb-2">
            <label class="form-label">Part Number</label>
            <input type="text" class="form-control" id="editPartNumber" disabled>
          </div>

          <div class="mb-2">
            <label class="form-label" for="editOperatorSelect">Operator</label>
            <select class="form-select" id="editOperatorSelect"></select>
          </div>

          <div class="mb-2">
            <label class="form-label" for="editStatusSelect">Status</label>
            <select class="form-select" id="editStatusSelect">
              <option value="Assigned">Assigned</option>
              <option value="In Progress">In Progress</option>
              <option value="Completed">Completed</option>
              <option value="Cancelled">Cancelled</option>
            </select>
          </div>

          <div class="mb-2">
            <label class="form-label" for="editInitialsInput">Your initials (required)</label>
            <input
              type="text"
              class="form-control"
              id="editInitialsInput"
              placeholder="e.g. WG">
          </div>

          <div id="editErrorMsg" class="text-danger small"></div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-outline-danger me-auto"
            onclick="deleteAssignment()">
            Delete Job
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal">
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            onclick="saveAssignmentChanges()">
            Save Changes
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- PapaParse for CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <!-- App JS -->
  <script src="app.js"></script>

</body>

</html>
